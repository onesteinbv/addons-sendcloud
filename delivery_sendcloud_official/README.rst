==================
SendCloud Shipping
==================

.. !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   !! This file is generated by oca-gen-addon-readme !!
   !! changes will be overwritten.                   !!
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

This module is part of the SendCloud official connector for Odoo.

At the moment, the SendCloud official connector for Odoo consists of two modules: delivery_sendcloud_official and website_sendcloud_official.

1) delivery_sendcloud_official. This module works for the backend.
2) website_sendcloud_official. This module is for the frontend (webshop) and it depends on delivery_sendcloud_official.


This module mostly implements what's described in https://docs.sendcloud.sc/api/v2/shipping/

Full documentation for developers is in https://docs.sendcloud.sc/.

This module works for the Community Edition as well as the Enterprise Edition.

**Table of contents**

.. contents::
   :local:

Installation
============

In the Odoo configuration file add ``delivery_sendcloud_official`` in the list
``server_wide_modules``:

.. code-block:: ini

  [options]
  (...)
  server_wide_modules = web,delivery_sendcloud_official
  (...)

A restart of the Odoo server is required afterwards.

Configuration
=============

Create an account on sendcloud.com and choose a plan.
Go to integrations and select Odoo integration to use the Odoo integration or select
api integration if you only want to use the api integration (see readme for more
information).

Odoo Integration
~~~~~~~~~~~~~~~~

Verify that the value of "web.base.url" parameter in System Parameters is set with
the correct url (eg.: "https://demo.onestein.eu" instead of "http://localhost:8069").

Go to SendCloud > Configuration > Wizards > Setup the SendCloud Integration. A wizard will pop up.

.. image:: /delivery_sendcloud_official/static/description/Image_10.png

Select Odoo Integration. Start Setup. You will be redirected to a SendCloud page asking you
to authorize OdooShop to access your Sendcloud account. Click on Connect in the SendCloud page.

.. image:: /delivery_sendcloud_official/static/description/Image_20.png

Go back to the Odoo Integration configuration. An integration "OdooShop" is now present
in the Integration list view. Open the OdooShop Integration form. Edit the OdooShop Integration.
The changes you make will be in sync, SendCloud side, with the integration configuration.

.. image:: /delivery_sendcloud_official/static/description/Image_30.png

In case multiple integrations are present, sort the integrations by sequence, to allow
Odoo to choose the default one that will be used.
Please note that when using the Odoo integration an "incoming order" is created in
Sendcloud as soon as you validate the salesorder. The “incoming order” has status
“in process” in Sendcloud and is not forwarded to the carrier yet.

.. image:: /delivery_sendcloud_official/static/description/Image_40.png

When you validate the delivery in Odoo the label is created and the pick-up assignment is send to the carrier.

.. image:: /delivery_sendcloud_official/static/description/Image_50.png

In previous version there was a possibility to connect to the API integration instead of the Odoo integration.
To benefit from Sendcloud support we highly recommend you to upgrade to the latest version of this module with
the Odoo integration.

SendCloud panel settings
~~~~~~~~~~~~~~~~~~~~~~~~

When you configure the Integration settings in the online SendCloud panel (https://panel.sendcloud.sc/)
those settings are also sync-ed with the Integration settings Odoo side.


Synchronize SendCloud objects
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

After the setup of the integration with SendCloud server is completed, second step is
to synchronize the objects present in SendCloud server to Odoo.
To synchronize SendCloud objects for the first time:

- Go to SendCloud > Configuration > Wizards > Sync the SendCloud Objects. A wizard will pop up.

.. image:: /delivery_sendcloud_official/static/description/Image_70.png

- Select all the objects. Confirm. This will retrieve the required data from SendCloud server.

.. image:: /delivery_sendcloud_official/static/description/Image_80.png

Some SendCloud objects will be automatically synchronized from the SendCloud server to Odoo.
Those SendCloud objects are:

- Parcel Statuses
- Invoices
- Shipping Methods
- Sender Addresses

To configure how often those objects should be retrieved from the SendCloud server:

- Go to Settings > Technical > Automation > Scheduled Actions. Search Scheduled Actions for "SendCloud".

.. image:: /delivery_sendcloud_official/static/description/Image_90.png

- Set the "Execute Every" value according to your needs.


Sender Addresses and Warehouses
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

In case of multiple warehouses configured in Odoo (eg.: user belongs to group "Manage multiple Warehouse"):

Go to SendCloud > Configuration > Integration. Click on Configure Warehouse Addresses. A wizard will pop up.
Set the corresponding Sendcloud Sender Address for each of the warehouse addresses.

.. image:: /delivery_sendcloud_official/static/description/Image_100.png

Alternatively, in Inventory > Configuration > Warehouses, select an address. In the address form, go to Sales and Purchase tab and set the Sencloud Sender Address.
In Sale Order > Delivery: select the Warehouse. Check that the address of the Warehouse has a Sendcloud Senser Address.

.. image:: /delivery_sendcloud_official/static/description/Image_110.png

Initial sync of past orders
~~~~~~~~~~~~~~~~~~~~~~~~~~~

Once all the previous configuration steps are completed, it is possible to synchronize
all the past Odoo outgoing shipments to Sendcloud.
Those shipments are the ones already setup with a SendCloud shipping method.

Go to SendCloud > Configuration > Wizards > Sync past orders to SendCloud. A wizard will pop up.
Select the date (by default set to 30 days back from today) from which the shipments
must be synchronized.

Click on Confirm button: the shipments will be displayed in the Incoming Order View tab of the Sendcloud panel.
They will contain a status “Ready to Process” if they are ready to generate a label and the order fulfillment will continue.

Test Mode
~~~~~~~~~

To enable the Test Mode, go to the "General Settings": under the SendCloud section you can find the "Enable Test Mode" flag.
Enabling the Test Mode allows you to access extra functionalities that are useful to test the connector.

There is no seperate test environment available on the Sendcloud portal. This means that
as soon as you create labels the carries is given the order to pickup the goods.
You can use carrier "unstamped letter" for testing.
When testing with other carriers make sure that you cancel the labels in the Sendcloud portal
within a couple of hours otherwise the label will be billed and picked up.

Since there is no test environment it's very important to know that Sendcloud stores it
records based on the delivery number, for instance WH/OUT/0001, this field is idempotent.
So when you start testing and you will use delivery number WH/OUT/00001 this number is
stored in Sendcloud. When you go live and use the same delivery numbers, in this case WH/OUT/00001,
Sendcloud will treat this as an update of the existing record and will send back the
shipping-address that was already stored (created while testing). To avoid this problem
you should set a different prefix on the sequence out in your testenvironment.
In debug mode, Technical/Sequences Identifiers/Sequences, select the sequence out and
adjust this to WH/OUT/TEST for instance.

.. image:: /delivery_sendcloud_official/static/description/Image_120.png


Usage
=====

Quickstart
==========

In short this is how the module works:

- the user creates a sale order in Odoo; the user clicks on "Add shipping" button and selects one of the shipping methods provided by SendCloud
- when confirming the sale order, a delivery document is generated (stock.picking)
- when confirming the picking, a parcel (or multiple parcels) for the specific sales order are created in Sendcloud under Shipping > Created labels
- the picking is updated with the information from Sendcloud (tracking number, tracking url, label etc...)

Map of Sendcloud-Odoo data models
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-----------------+-------------------+
| SendCloud       | Odoo              |
+=================+===================+
| Integration     |                   |
+-----------------+-------------------+
| Brand           | Website Shop      |
+-----------------+-------------------+
| Order           | Sales Order       |
+-----------------+-------------------+
| Shipment        | Picking           |
+-----------------+-------------------+
| Parcel (colli)  | Picking packs     |
+-----------------+-------------------+
| Sender address  | Warehouse address |
+-----------------+-------------------+
| Shipping Method | Shipping Method   |
+-----------------+-------------------+


Multicollo parcels
~~~~~~~~~~~~~~~~~~

In Inventory > Configuration > Delivery Packages, set the carrier to Sendcloud.
In the out picking, put the products in different Sendcloud packages to create Multicollo parcels.

Service Point Picker
~~~~~~~~~~~~~~~~~~~~

The module contains a widget, the Service Point Picker, that allows the selection of the service point.
The widget is placed in the "SendCloud Shipping" tab of the picking. The widget is visible in case the following is true:

 - the configuration in the SendCloud panel has the Service Point flag to True (in the SendCloud integration config)
 - the Shipping Method selected in the picking is provided by Sendcloud
 - the Shipping Method has field sendcloud_service_point_input == "required"
 - all the criteria (from country, to country, weight) match with the current order

Cancel parcels
~~~~~~~~~~~~~~

When canceling parcels a confirmation popup will ask for confirmation.


Troubleshooting
~~~~~~~~~~~~~~~

If the communication to the SendCloud server fails (eg.: while creating a parcel),
the exchanged message is stored in a Log section, under Logging > Actions.

Known issues / Roadmap
======================

TODO
====

- Enable different Shipping Methods for different Websites

Bug Tracker
===========

Bugs are tracked on `GitHub Issues <https://github.com/onesteinbv/addons-sendcloud/issues>`_.
In case of trouble, please check there if your issue has already been reported.
If you spotted it first, help us smashing it by providing a detailed and welcomed
`feedback <https://github.com/onesteinbv/addons-sendcloud/issues/new?body=module:%20delivery_sendcloud_official%0Aversion:%2014.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**>`_.

Do not contact contributors directly about support or help with technical issues.

Credits
=======

Authors
~~~~~~~

* Onestein

Maintainers
~~~~~~~~~~~

This module is part of the `onesteinbv/addons-sendcloud <https://github.com/onesteinbv/addons-sendcloud/tree/14.0/delivery_sendcloud_official>`_ project on GitHub.

You are welcome to contribute.
